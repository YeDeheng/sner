Manage	O
mousedown	O
events	O
with	O
javascript	B-PL
when	O
highlighting	O
and	O
unhighlighting	O
text	O

G'day	O
,	O

I've	O
been	O
working	O
on	O
some	O
logic	O
to	O
process	O
highlighted	O
text	O
by	O
a	O
user	O
.	O

I	O
found	O
a	O
very	O
good	O
example	O
by	O
Mark	O
Koli	O
at	O
http://mark.koli.ch/2009/09/use-javascript-and-jquery-to-get-user-selected-text.html	O
.	O

I've	O
created	O
a	O
working	O
example	O
at	O
:	O
http://jsfiddle.net/metalskin/43c8h/8	O

I	O
have	O
a	O
problem	O
with	O
the	O
code	O
for	O
a	O
specific	O
instance	O
as	O
follows	O
:	O

select	O
some	O
text	O
.	O
dialog	O
appears	O
.	O
close	O
dialog	O
.	O
now	O
click	O
without	O
a	O
drag	O
to	O
clear	O
the	O
highlighted	O
text	O
.	O
dialog	O
appears	O
.	O
close	O
dialog	O
.	O
text	O
is	O
deselected	O
.	O

In	O
my	O
logic	O
I'm	O
not	O
using	O
a	O
dialog	O
(	O
it	O
'	O
s	O
just	O
easier	O
as	O
an	O
example	O
)	O
,	O
I'm	O
inserting	O
a	O
div	O
with	O
an	O
image	O
to	O
allow	O
the	O
user	O
to	O
perform	O
an	O
action	O
.	O

The	O
problem	O
is	O
that	O
the	O
second	O
click	O
is	O
really	O
to	O
clear	O
the	O
text	O
,	O
but	O
for	O
some	O
reason	O
the	O
browser	O
is	O
firing	O
the	O
mouse	O
up	O
event	O
before	O
the	O
browser	O
clears	O
the	O
text	O
(	O
well	O
under	O
firefox	B-Fram
anyway	O
)	O
.	O

This	O
is	O
not	O
obviously	O
a	O
problem	O
with	O
the	O
dialog	O
poping	O
up	O
,	O
but	O
with	O
my	O
logic	O
I	O
end	O
up	O
getting	O
multiple	O
div	O
'	O
s	O
added	O
,	O
and	O
as	O
such	O
multiple	O
floating	O
images	O
over	O
the	O
text	O
.	O

Is	O
there	O
someway	O
to	O
determine	O
that	O
the	O
event	O
will	O
result	O
in	O
the	O
highlighted	O
text	O
being	O
removed	O
?	O

Ideally	O
I	O
would	O
rather	O
the	O
event	O
fire	O
after	O
the	O
browser	O
has	O
cleared	O
the	O
text	O
.	O

Thanks	O
in	O
advance	O
(	O
and	O
sorry	O
if	O
a	O
newb	O
question	O
,	O
I'm	O
really	O
rough	O
when	O
it	O
comes	O
to	O
javascript	B-PL
)	O
.	O

:	O
edit	O
:	O

I	O
should	O
explain	O
the	O
use	O
case	O
of	O
how	O
I'm	O
using	O
it	O
.	O

user	O
highlights	O
text	O
on	O
a	O
page	O
an	O
icon	O
appears	O
above	O
where	O
they	O
just	O
released	O
the	O
mouse	O
button	O
from	O
highlighting	O
the	O
text	O
the	O
user	O
selects	O
the	O
icon	O
,	O
which	O
opens	O
up	O
a	O
form	O
to	O
enter	O
some	O
details	O
to	O
mark	O
against	O
the	O
highlighted	O
text	O
(	O
the	O
icon	O
is	O
removed	O
at	O
this	O
point	O
in	O
time	O
)	O
the	O
user	O
submits	O
the	O
form	O
(	O
ajax	B-Stan
)	O
,	O
the	O
form	O
closes	O
.	O
page	O
is	O
displayed	O
,	O
highlighted	O
text	O
is	O
now	O
not	O
highlighted	O
(	O
but	O
extra	O
markup	O
is	O
added	O
)	O
.	O

or	O

user	O
highlights	O
text	O
on	O
a	O
page	O
an	O
icon	O
appears	O
above	O
where	O
they	O
just	O
released	O
the	O
mouse	O
button	O
from	O
highlighting	O
the	O
text	O
the	O
user	O
clicks	O
elsewhere	O
on	O
the	O
page	O
to	O
both	O
remove	O
the	O
highlighted	O
text	O
and	O
remove	O
the	O
icon	O
.	O
the	O
user	O
submits	O
the	O
form	O
,	O
the	O
form	O
closes	O
.	O

I've	O
no	O
problems	O
with	O
the	O
selected	O
text	O
being	O
de-selected	O
when	O
the	O
icon	O
is	O
chosen	O
,	O
but	O
the	O
problem	O
is	O
if	O
they	O
click	O
on	O
another	O
part	O
of	O
the	O
page	O
,	O
it	O
reactivates	O
the	O
mouse	O
event	O
and	O
thus	O
double	O
icons	O
(	O
or	O
a	O
dialog	O
when	O
it	O
'	O
s	O
not	O
appropriate	O
in	O
the	O
example	O
provided	O
)	O
.	O

Here	O
you	O
go	O
^_^	O

http://jsfiddle.net/43c8h/16	O

I	O
just	O
changed	O
this	O
piece	O
of	O
code	O
to	O
clear	O
the	O
selection	O
on	O
the	O
mouse	O
up	O
event	O
.	O

@codeSnippetRemoved	O

Or	O
if	O
you	O
wanted	O
to	O
keep	O
the	O
text	O
highlighted	O
after	O
the	O
user	O
had	O
selected	O
it	O
,	O
you	O
could	O
call	O
a	O
mousedown	O
function	O
with	O
the	O
same	O
window.getSelection()	B-API
.removeAllRanges()	O
;	O
code	O
to	O
clear	O
the	O
selection	O
every	O
time	O
the	O
mouse	O
is	O
clicked	O
.	O
